(this["webpackJsonpkozi-frontend"]=this["webpackJsonpkozi-frontend"]||[]).push([[0],{215:function(e,t,a){e.exports=a.p+"static/media/map-floor-3.c5b287e8.svg"},218:function(e,t,a){e.exports=a.p+"static/media/kozi-isaac-logo.df9a5e3a.png"},223:function(e,t,a){e.exports=a.p+"static/media/kozi-isaac-logo.df9a5e3a.png"},225:function(e,t,a){e.exports=a(361)},240:function(e,t,a){},242:function(e,t,a){},243:function(e,t,a){},248:function(e,t){},250:function(e,t){},262:function(e,t){},264:function(e,t){},292:function(e,t){},294:function(e,t){},295:function(e,t){},301:function(e,t){},303:function(e,t){},321:function(e,t){},323:function(e,t){},335:function(e,t){},338:function(e,t){},357:function(e,t,a){},358:function(e,t,a){e.exports=a.p+"static/media/OpenSans-Regular.3ed9575d.ttf"},359:function(e,t,a){},360:function(e,t,a){},361:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(39),c=a.n(r),o=a(15),i=a(92),s=a(40),m=a(367);function u(){var e=Object(i.a)(["\n  {\n    MeanClimateMeasurements {\n      floor\n      loc_x\n      loc_y\n      temperature\n      humidity\n    },\n    SensorFaults {\n      id\n      loc_x\n      loc_y\n      floor\n      timestamp\n      fault_code\n    }\n  }\n  \n"]);return u=function(){return e},e}var d=Object(s.gql)(u());function f(){var e=Object(s.useQuery)(d,{pollInterval:1e4}),t=e.data,a=e.loading;if(e.error)return l.a.createElement("h1",null,"Something went wrong. Please try again");var n=[],r=[];return t&&(n=t.MeanClimateMeasurements.filter((function(e){return!t.SensorFaults.some((function(t){return e.loc_x===t.loc_x&&e.loc_y===t.loc_y&&e.floor===t.floor}))})),r=t.SensorFaults),l.a.createElement("div",null,a&&l.a.createElement("div",{className:"d-flex"},l.a.createElement(m.a,{className:"mx-auto",animation:"border",role:"status"}," ")),l.a.createElement(C,{workingSensors:n,faultySensors:r}),l.a.createElement(D,{workingSensors:n}))}var E=function(){return l.a.createElement("main",null,l.a.createElement(o.d,null,l.a.createElement(o.b,{path:"/login",component:V}),l.a.createElement(o.b,{exact:!0,path:"/",component:f}),l.a.createElement(o.b,{path:"*",component:function(){return l.a.createElement("div",null,"error not found")}})))},p=(a(239),Object(o.h)((function(e){var t=e.location;return l.a.createElement("div",null,"/login"!==t.pathname&&l.a.createElement(z,null),l.a.createElement(E,null))}))),g=a(33),h=a(368),b=a(369),v=a(370),N=a(217),x=a(215),y=a.n(x),w=(a(240),a(96)),_=a(97),O=a(0).useState,k=a(136),S=a(224),j=(a(242),a(216)),M=a.n(j),R=function(e){var t=e.data;return Object(n.useEffect)((function(){var e=document.querySelector(".heatmap-container");if(t&&t.length){var a=t.map((function(t){return Object(S.a)({x:20+t.xPercent*e.scrollWidth/100,y:10+t.yPercent*e.scrollHeight/100},t)})),n=M.a.create({container:e,radius:e.scrollWidth/5,maxOpacity:.4,minOpacity:0,blur:1,gradient:{".0":"rgb(0,255,255)",".2":"rgb(0,200,200)",".4":"rgb(0,150,150)",".6":"rgb(0,100,200)",".8":"rgb(150,0,250)",1:"rgb(255,0,0)"}}),l=Math.max.apply(Math,Object(k.a)(a.map((function(e){return e.value})))),r=Math.min.apply(Math,Object(k.a)(a.map((function(e){return e.value}))));return n.setData({data:a}).setDataMin(r).setDataMax(l),function(){var e=document.querySelector(".heatmap-container canvas");e&&e.remove()}}})),l.a.createElement("div",{className:"heatmap-component"},l.a.createElement("div",{className:"heatmap-container"}))},C=function(e){var t=e.workingSensors,a=e.faultySensors,n=function(e){var t=O(!!e),a=Object(g.a)(t,2),n=a[0],l=a[1];return[n,function(){l(!n)}]}("false"!==localStorage.getItem("PREFERENCES_SHOW_HEATMAP")),r=Object(g.a)(n,2),c=r[0],o=r[1],i=t.map((function(e){return{xPercent:3.125*(e.loc_x-1),yPercent:(e.loc_y-1)*(100/14),value:e.temperature}}));return l.a.createElement(h.a,{fluid:!0},l.a.createElement(b.a,{className:"justify-content-center mt-n4 pb-3"},l.a.createElement(v.a,{xs:11,lg:10},l.a.createElement(N.a,{variant:"outline-primary",onClick:function(){localStorage.setItem("PREFERENCES_SHOW_HEATMAP",!c),o()}},l.a.createElement(w.a,{icon:_.a,size:"2x",className:"pr-1"}),"Heatmap"))),l.a.createElement(b.a,{className:"justify-content-center"},l.a.createElement(v.a,{xs:11,lg:10,className:"p-0"},c&&l.a.createElement(R,{data:i}),t.map((function(e){return l.a.createElement($,Object.assign({key:[e.loc_x,e.loc_y,e.floor].join("-")},e,{cellHeight:100/14,cellWidth:3.125}))})),a.map((function(e){return l.a.createElement($,Object.assign({key:[e.loc_x,e.loc_y,e.floor].join("-")},e,{cellHeight:100/14,cellWidth:3.125,faulty:!0}))})),l.a.createElement("img",{className:"w-100 floor-map",src:y.a,alt:"Map of the floor"}))))},T=a(373),F=a(372),L=a(371),A=(a(243),a(218)),I=a.n(A),P=a(244),H=function(){var e=Object(n.useState)(null),t=Object(g.a)(e,2),a=t[0],l=t[1],r=localStorage.getItem("token"),c=P.decode(r);return c&&!a&&l({email:c.email,logout:function(){localStorage.removeItem("token"),l(!1)},refresh:function(){l(!1)}}),a};function z(){var e=Object(o.g)(),t=H();return l.a.createElement(h.a,{fluid:!0,className:"px-0 pb-5"},l.a.createElement(T.a,{className:"d-flex",style:{background:"white",minHeight:120},expand:"lg"},l.a.createElement("div",{style:{flex:1}},l.a.createElement(T.a.Brand,{className:"screen-center"},l.a.createElement("img",{alt:"Kozi Isaac logo",src:I.a,width:"300px",className:"align-top logo img-fluid"}))),t&&l.a.createElement(F.a,null,l.a.createElement(L.a,null,l.a.createElement(L.a.Toggle,{className:"font-weight-bold",variant:"none"},t.email),l.a.createElement(L.a.Menu,{alignRight:!0},l.a.createElement(L.a.Item,{onClick:t.logout},"Log out")))),!t&&l.a.createElement(F.a,null,l.a.createElement("div",{onClick:function(){e.push("/login")},className:"text-center login-buttons"},l.a.createElement(w.a,{icon:_.b,size:"3x"}),l.a.createElement(F.a.Link,{href:"login",className:"text-decoration-none lead font-weight-bold"},"Login")))))}a(357);var D=function(e){var t=e.workingSensors,a=t.reduce((function(e,t){return e+t.temperature}),0)/t.length||0,n=t.reduce((function(e,t){return e+t.humidity}),0)/t.length||0;return l.a.createElement(h.a,null,l.a.createElement(b.a,{lg:"8",xl:"7",className:"justify-content-center"},l.a.createElement(v.a,{className:"widget "},l.a.createElement("h1",{className:"value"},t.length),l.a.createElement("p",{className:"description"},"Active sensors")),l.a.createElement(v.a,{className:"widget"},l.a.createElement("h1",{className:"value"},a.toFixed(1),"\xb0C"),l.a.createElement("p",{className:"description"},"Avg.Temp")),l.a.createElement(v.a,{className:"widget"},l.a.createElement("h1",{className:"value"},n.toFixed(1),"%"),l.a.createElement("p",{className:"description"},"Avg.Hum"))))},W=(a(358),a(359),a(376)),q=a(374);var U=function(e){return""===e.fault_code?l.a.createElement(W.a,{transition:null,show:e.show,target:e.target,placement:"top",containerPadding:20},l.a.createElement(q.a,{id:"popover-contained"},l.a.createElement(q.a.Title,{className:"text-nowrap",style:{backgroundColor:"#349CDB",color:"#ffffff"},as:"h3"},"Sensor Information"),l.a.createElement(q.a.Content,null,l.a.createElement("strong",null,"Floor:")," ",e.floor,l.a.createElement("br",null),l.a.createElement("strong",null,"X:")," ",e.loc_x+" ",l.a.createElement("strong",null,"Y:")," ",e.loc_y,l.a.createElement("br",null),l.a.createElement("strong",null,"T:")," ",(Math.round(100*e.temperature)/100).toFixed(1)+" \xb0C ",l.a.createElement("strong",null,"H:")," ",(Math.round(100*e.humidity)/100).toFixed(1)))):l.a.createElement(W.a,{transition:null,show:e.show,target:e.target,placement:"top",containerPadding:20},l.a.createElement(q.a,{id:"popover-contained"},l.a.createElement(q.a.Title,{className:"text-nowrap",style:{backgroundColor:"#C12D3F",color:"#ffffff"},as:"h3"},"Sensor Information"),l.a.createElement(q.a.Content,null,l.a.createElement("strong",null,"An unexpected error occured:"),l.a.createElement("br",null),function(e){switch(e){case"ERROR_TEMPERATURE_OUT_OF_RANGE":return"Temperature was unreasonably high or low";case"ERROR_TEMPERATURE_DIFFERENCE_MORE_THAN_2_CELSIUS":return"Temperature changed abruptly";case"ERROR_NOT_ENOUGH_VALID_ENTRIES":return"Sensor did not send enough temperature measurements";default:return"Unknown error..."}}(e.fault_code))))};function $(e){var t=e.floor,a=e.loc_x,r=e.loc_y,c=e.faulty,o=e.fault_code,i=e.cellHeight,s=void 0===i?3.125:i,m=e.cellWidth,u=void 0===m?100/14:m,d=e.temperature,f=void 0===d?0:d,E=e.humidity,p=Object(n.useState)(!1),h=Object(g.a)(p,2),b=h[0],v=h[1],N=Object(n.useState)(null),x=Object(g.a)(N,2),y=x[0],w=x[1],_=Object(n.useRef)(null),O=function(e){v(!0),w(e.target)},k=function(e){v(!1)};return c?l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{onMouseEnter:O,onMouseLeave:k,className:"sensor faulty-sensor",style:{position:"absolute",left:(a-1.25)*u+"%",top:(r-1.25)*s+"%",width:u+"%",height:s+"%"}},l.a.createElement("span",null,"!"),l.a.createElement(U,{show:b,target:y,floor:t,fault_code:o,loc_x:a,loc_y:r}))):l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{ref:_,onMouseEnter:O,onMouseLeave:k,className:"sensor working-sensor",style:{left:(a-1.25)*u+"%",top:(r-1.25)*s+"%",width:u+"%",height:s+"%"}},l.a.createElement("span",null,f.toFixed(1)+"\xb0C"),l.a.createElement(U,{show:b,target:y,floor:t,temperature:f,fault_code:"",humidity:E,loc_x:a,loc_y:r})))}a(360);var B=a(223),G=a.n(B),J=a(375);function Q(){var e=Object(i.a)(["query Login($email: String, $password:String){\n    Login(email: $email password: $password){\n      accessToken \n      error\n    }\n  }\n"]);return Q=function(){return e},e}var K=Object(s.gql)(Q());function V(){var e=Object(o.g)(),t=Object(n.useState)(null),a=Object(g.a)(t,2),r=a[0],c=a[1],i=H(),m=Object(s.useLazyQuery)(K),u=Object(g.a)(m,2),d=u[0],f=u[1],E=f.error,p=f.data;return i?l.a.createElement(o.a,{to:"/"}):p&&p.Login.accessToken?(localStorage.setItem("token",p.Login.accessToken),l.a.createElement(o.a,{to:"/"})):(p&&p.Login.error&&p.Login.error!==r&&c(p.Login.error),E&&console.log(E),l.a.createElement("div",{className:"main-login"},l.a.createElement("small",null," ",i&&i.email," "),l.a.createElement("link",{href:"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css",rel:"stylesheet"}),l.a.createElement("div",{className:"d-md-flex h-md-100 align-items-center"},l.a.createElement("div",{className:"col-md-6 pt-md-5 p-0 h-md-100 "},l.a.createElement("div",{className:"text-white  d-md-flex h-100 p-5"},l.a.createElement("div",{className:"p-md-5 pb-5"},l.a.createElement("div",{className:"d-flex justify-content-center align-items-center"},l.a.createElement("div",{className:"col-10 col-md-10"},l.a.createElement("img",{className:"img img-fluid",src:G.a,alt:"logo"}))),l.a.createElement("hr",null),l.a.createElement("p",{className:"text-p-secondary h2 mt-5"},"Login"),l.a.createElement("form",{className:"mt-3",onSubmit:function(e){e.preventDefault(),d({variables:{email:e.target.elements.email.value,password:e.target.elements.password.value}})}},l.a.createElement("label",{htmlFor:"email",className:"text-p-secondary"},"Email"),l.a.createElement("div",{className:"input-group"},l.a.createElement("div",{className:"input-group-prepend"},l.a.createElement("span",{className:"input-group-text"},l.a.createElement("i",{className:"fa fa-envelope","aria-hidden":"true"}))),l.a.createElement("input",{type:"email",name:"email",className:"form-control"})),l.a.createElement("label",{htmlFor:"email",className:"text-p-secondary mt-4"},"Password"),l.a.createElement("div",{className:"input-group"},l.a.createElement("div",{className:"input-group-prepend"},l.a.createElement("span",{className:"input-group-text"},l.a.createElement("i",{className:"fa fa-unlock-alt","aria-hidden":"true"}))),l.a.createElement("input",{type:"password",name:"password",className:"form-control"})),l.a.createElement(J.a,{className:"mt-4",show:r,variant:"info"}," ",r," "),l.a.createElement("div",{className:"col-xl-6"},l.a.createElement("button",{id:"submitAction",type:"submit",className:"btn btn-p-primary btn-block btn-round mt-5  "},l.a.createElement("span",{id:"main-executeAction",className:"text-p-primary text-font-primary"},"Login"))))))),l.a.createElement("div",{className:"col-md-6 bg-blue "},l.a.createElement("div",{className:"d-flex flex-column align-items-center h-md-100  p-5 justify-content-center"},l.a.createElement("h1",{id:"side-action",className:"h1 text-white"},"Guest"),l.a.createElement("p",{id:"side-description",className:"text-white h4 text-center"},"Enter to view real-time sensor information!"),l.a.createElement("a",{href:"/",id:"switcher",onClick:function(t){t.preventDefault(),e.push("")},className:"btn btn-round btn-switcher btn-lg btn-block mt-3"},"Login as a guest"))))))}var X=a(58),Y=new s.ApolloClient({uri:"https://kozi-backend.herokuapp.com/graphql",cache:new s.InMemoryCache}),Z=document.getElementById("root");c.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(s.ApolloProvider,{client:Y},l.a.createElement(X.a,{basename:"/kozi-frontend"},l.a.createElement(p,null)))),Z)}},[[225,1,2]]]);
//# sourceMappingURL=main.92afcdf1.chunk.js.map